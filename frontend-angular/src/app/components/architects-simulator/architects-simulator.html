<div class="mb-8 p-4 bg-[#0A0A0A] border border-[#222] rounded-lg">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-bold text-[#00FF41] flex items-center gap-2">
        <span class="text-xs font-mono text-[#666]">[SYSTEM]</span>
        <span>LA SIMULATION DE L'ARCHITECTE</span>
      </h2>
    </div>

    <ng-container *ngIf="characters$ | async as characters">
      <div class="cards-container"
           [class.grid]="!isMobile"
           [class.md:grid-cols-2]="!isMobile"
           [class.lg:grid-cols-3]="!isMobile"
           [class.xl:grid-cols-5]="!isMobile"
           [class.gap-6]="!isMobile"
           [class.expanded]="!isMobile || otherCharactersVisible">
        
        <div *ngFor="let char of characters; let i = index" 
             class="card-wrapper" 
             [class.first-card-wrapper]="i === 0">

          <app-character-card [character]="char" (cardClick)="onCharacterCardClick(char)"></app-character-card>

          <div *ngIf="i === 0 && isMobile && characters.length > 1" 
               (click)="toggleMatrix()" 
               class="reveal-icon-container">
            <!-- Chevron Down -->
            <svg *ngIf="!otherCharactersVisible" class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
            <!-- Chevron Up -->
            <svg *ngIf="otherCharactersVisible" class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7"></path>
            </svg>
          </div>
        </div>
      </div>
    </ng-container>

    <!-- Divider -->
    <hr class="border-t-2 border-dashed border-[#222] my-4">

    <!-- History is now always visible below -->
    <app-simulation-history></app-simulation-history>
</div>

<!-- Character History Modal -->
<app-character-history-modal 
    *ngIf="selectedCharacter"
    [character]="selectedCharacter"
    [characterTickets]="processedOracleTickets"
    (close)="closeHistoryModal()">
</app-character-history-modal>